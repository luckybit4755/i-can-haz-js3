<HTML>
	<HEAD>
		<TITLE>SkyboxTest</TITLE>

		<style>
			body {
				font-family: Comic Sans MS, sans;
			}
			input[type="range"] {
				width:498px;
			}
		</style>

        <script src="../../src/util/MatrixMath.js"></script>
        <script src="../../src/util/SkyBox.js"></script>
        <script src="../../src/util/Point.js"></script>
        <script src="../../src/weak//Bresenham6d.js"></script>
        <script src="../../src/weak/TriangularB6.js"></script>

		<script type="text/javascript">
			const nextFrame = function( cb, fps ) {
				setTimeout(
					function() {
						requestAnimationFrame( cb );
					}, 1000 / fps
				);
			};

			window.onload = function() {
                const canvas = document.getElementsByTagName( 'canvas' )[ 0 ];
                const tb6 = new TriangularB6( canvas );

				const info = document.getElementById( 'info' );

				var scale = 1;
				const scaleRange = document.getElementById( 'scale' );
				scaleRange.onclick = scaleRange.onchange = scaleRange.oninput = function() {
					scale = scaleRange.value;
				};
				scaleRange.click();
				
				var threshold = 80;
				const thresholdRange = document.getElementById( 'threshold' );
				thresholdRange.onclick = thresholdRange.onchange = thresholdRange.oninput = function() {
					threshold = thresholdRange.value;
				};
				thresholdRange.click();

                MatrixMath.init();
				
				var skyBox = new SkyBox( 7 );

                var iteration = 0;
                var angles = [0,0,0];
                var which = 0;
                const angle_increment = 0.08;

				var draw = function() {
					tb6.clear();

					angles[ which % 3 ] += angle_increment;
					if ( 0 == iteration++ % 33 ) which++;

                    var rotations = MatrixMath.makeRotations( angles[ 0 ], angles[ 1 ], angles[ 2 ] );

					var tmp = MatrixMath.multiply( rotations, MatrixMath.scale( scale, scale, scale ) );
					rotations = tmp;

					var count = skyBox.display( tb6, rotations, threshold );
					info.innerHTML = 'using ' + count + ' with threshold:' + threshold + ' and scale:' + scale;

					tb6.flush();

					if ( !false ) {
						nextFrame( draw, 32 );
					}
				};
				draw();
			};
		</script>
	</HEAD>
	<BODY>
		<canvas width="512" height="512"></canvas>
		<div id="info"></div>
		<div>
			<input id="scale" type="range" value="1" min="0" max="4" step="0.01"></input>
			scale
		</div>
		<div>
			<input id="threshold" type="range" value="64" min="0" max="256" step="1"></input>
			threshold
		</div>
	</BODY>
</HTML>
